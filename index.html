<!DOCTYPE HTML>
<html>
<head>
	<style>
		#ml_main
		{
			text-align:center;
		}
		#ml_seatsDiv
		{
			text-align:center;
		}
		#ml_conditionDiv
		{
			text-align:center;
		}

        table
        {
            border-collapse: collapse;
            margin: 0 auto;
            text-align: center;
        }
        table td, table th
        {
            border: 1px solid #cad9ea;
            color: #666;
            height: 30px;
        }
        table thead th
        {
            background-color: #CCE8EB;
            width: 100px;
        }
        table tr:nth-child(odd)
        {
            background: #fff;
        }
        table tr:nth-child(even)
        {
            background: #F5FAFA;
        }
	</style>
	<script>
	function ml_randomNum(minNum,maxNum){ 
    switch(arguments.length){ 
        case 1: 
            return parseInt(Math.random()*minNum+1,10); 
        break; 
        case 2: 
            return parseInt(Math.random()*(maxNum-minNum+1)+minNum,10); 
        break; 
        default: 
            return 0; 
        break; 
		} 
	} 
	function Ml_Conditon(id,student1,student2,isNeighbor)
	{
		this.condition=["上","下","左","右"];
		this.conditionId=id;
		this.student1=student1;
		this.student2=student2;
		this.isNeighbor=isNeighbor;
		return this;
	}
	var ml_global={};
	ml_global.students=[];
	ml_global.visited={};
	ml_global.seats=[];
	ml_global.row=0;
	ml_global.line=0;
	ml_global.condition=[];
	function ml_creatTable(data)
	{
		var tableData="";
		for(var i=0;i<data.length;i++)
		{
			tableData+="<tr>";
			for(var j=0;j<data[i].length;j++)
				tableData+="<td>"+data[i][j]+"</td>";
			tableData+="</tr>"
		}

		return tableData;
	}
	function ml_creatOption(data,id,name)
	{
		var tableData='<select id="'+id+'" name="'+name+'">';
		for(var i=0;i<data.length;i++)
		{
			tableData+="<option value="+'"'+i+'"'+">";
			tableData+=data[i];
			tableData+="</option>";
		}
		tableData+="</select>";
		return tableData;
	}
	function ml_update()
	{
		document.getElementById("ml_must1").innerHTML=ml_creatOption(ml_global.students,"ml_optionMust1","ml_mustFirst");
		document.getElementById("ml_must2").innerHTML=ml_creatOption(ml_global.students,"ml_optionMust2","ml_mustSecond");
		document.getElementById("ml_not1").innerHTML=ml_creatOption(ml_global.students,"ml_optionNot1","ml_notFirst");
		document.getElementById("ml_not2").innerHTML=ml_creatOption(ml_global.students,"ml_optionNot2","ml_notFirst");
	}
	function ml_addName_oc()
	{
		ml_global.students.push(ml_fromName.value);
		ml_studentJson.innerHTML=JSON.stringify(ml_global.students);
		ml_update();
	}
	function ml_inputJSON_oc()
	{
		if(JSON.parse(ml_fromJSON.value) instanceof Array)
		{
			ml_global.students=JSON.parse(ml_fromJSON.value);
			ml_studentJson.innerHTML=JSON.stringify(ml_global.students);
			ml_update();
		}
		else
		{
			alert("非法的JSON格式！");
		}
	}
	function ml_set_oc()
	{
		ml_global.row=document.getElementById("ml_row").value;
		ml_global.line=document.getElementById("ml_line").value;
		ml_global.seats=[];
		for (var i=0;i<ml_global.line;i++)
		{
			ml_global.seats.push([]);
			for (var j=0;j<ml_global.row;j++)
			{
				ml_global.seats[i].push("空位置");
			}
		}
		document.getElementById("ml_data").innerHTML=ml_creatTable(ml_global.seats);
	}
	function ml_setmust_oc()
	{
		if(ml_conditionMust.value==="-请选择条件-")
		{
			alert("请选择条件！");
			return;
		}
		if(ml_optionMust1.value===ml_optionMust2.value)
		{
			alert("条件不正确！");
			return;
		}
		for(var i=0;i<ml_global.condition.length;i++)
		{
			if((ml_global.condition[i].student1===ml_optionMust1.value&&ml_global.condition[i].student2===ml_optionMust2.value)||(ml_global.condition[i].student2===ml_optionMust1.value&&ml_global.condition[i].student1===ml_optionMust2.value))
			{
				alert("已存在条件！");
				return;
			}
		}
		ml_global.condition.push(new Ml_Conditon(ml_conditionMust.value,ml_optionMust1.value,ml_optionMust2.value,1));
		ml_conditionJson.innerHTML=JSON.stringify(ml_global.condition)
	}
	function ml_setnot_oc()
	{
		if(ml_conditionNot.value==="-请选择条件-")
		{
			alert("请选择条件！");
			return;
		}
		if(ml_optionNot1.value===ml_optionNot2.value)
		{
			alert("条件不正确！");
			return;
		}
		for(var i=0;i<ml_global.condition.length;i++)
		{
			if((ml_global.condition[i].student1===ml_optionNot1.value&&ml_global.condition[i].student2===ml_optionNot2.value)||(ml_global.condition[i].student2===ml_optionNot1.value&&ml_global.condition[i].student1===ml_optionNot2.value))
			{
				alert("已存在条件！");
				return;
			}
		}
		ml_global.condition.push(new Ml_Conditon(ml_conditionNot.value,ml_optionNot1.value,ml_optionNot2.value,0));
		ml_conditionJson.innerHTML=JSON.stringify(ml_global.condition)
	}
	function ml_importJSON_oc()
	{
		if(JSON.parse(ml_conditionJSON.value) instanceof Array)
		{
			ml_global.condition=JSON.parse(ml_conditionJSON.value);
			ml_conditionJson.innerHTML=JSON.stringify(ml_global.condition);
			ml_update();
		}
		else
		{
			alert("非法的JSON格式！");
		}
	}
	function ml_generate_oc()
	{
		ml_set_oc();
		for (var i=0;i<ml_global.students.length;i++)
		{
			var x=ml_randomNum(0,ml_global.line-1);
			var y=ml_randomNum(0,ml_global.row-1);
			while(!(ml_global.seats[x][y]==="空位置"))
			{
				x=ml_randomNum(0,ml_global.line-1);
				y=ml_randomNum(0,ml_global.row-1);
			}
			ml_global.seats[x][y]=ml_global.students[i];
		}
		document.getElementById("ml_data").innerHTML=ml_creatTable(ml_global.seats);
	}
	</script>
	<title>位置安排系统</title>
</head>
<body>

<div id="ml_main">
	<span>从姓名添加学生</span>
	<input id="ml_fromName"/>
	<button id="ml_addName" onclick="ml_addName_oc()">添加</button>
	<br/>
	<span>从JSON添加学生</span>
	<textarea id="ml_fromJSON"></textarea>
	<button id="ml_importJSON" onclick="ml_inputJSON_oc()">导入</button>
	<br/>
	<span>从JSON设置限制条件</span>
	<textarea id="ml_conditionJSON"></textarea>
	<button id="ml_importJSON" onclick="ml_importJSON_oc()">导入</button>
	<br/>
</div>
<div id="ml_conditionDiv">
	<span>必须满足的相邻条件</span>
	<select id="ml_conditionMust" name="conditionMust">
           <option>-请选择条件-</option>
           <option value="1">上</option>
           <option value="2">下</option>
           <option value="3">左</option>
	   <option value="4">右</option>
    </select>
	<span>学生1</span>
	<div id="ml_must1"></div>
	<span>学生2</span>
	<div id="ml_must2"></div>
	<button id="ml_setmust" onclick="ml_setmust_oc()">设置相邻条件</button>
</div>
<div id="ml_conditionDiv">
	<span>必须满足的不相邻条件</span>
	<select id="ml_conditionNot" name="conditionNot">
           <option>-请选择条件-</option>
           <option value="1">上</option>
           <option value="2">下</option>
           <option value="3">左</option>
	   <option value="4">右</option>
    </select>
	<span>学生1</span>
	<div id="ml_not1"></div>
	<span>学生2</span>
	<div id="ml_not2"></div>
	<button id="ml_setnot" onclick="ml_setnot_oc()">设置不相邻条件</button>
</div>
<div id="ml_seatsDiv">
	<span>桌椅排列</span>
    <span>行数</span>
	<input id="ml_line"/>
	<span>列数</span>
	<input id="ml_row"/>
	<button onclick="ml_set_oc()">设置</button>
</div>
<button id="displayJson" onclick='(function ml_displayJson_oc(){ml_json.style=""})()'>显示JSON数据</button>
<button id="hideJson" onclick='(function ml_hideJson_oc(){ml_json.style="display:none"})()'>隐藏JSON数据</button>
<div id="ml_json" style="display:none">
	<div id="ml_jsonDiv">
		<span>学生json数据</span>
		<div id="ml_studentJson">[]</div>
	</div>
	<div id="ml_jsonDiv">
		<span>条件json数据</span>
		<div id="ml_conditionJson">{}</div>
	</div>
</div>
<div id="ml_generate">
	<button id="ml_buttonGenerate" onclick="ml_generate_oc()">随机生成</button>
	<button id="ml_condGenerate" onclick="ml_condGenerate_oc()">按条件生成</button>
</div>
<table id="ml_data">
</table>

</body>
</html>
